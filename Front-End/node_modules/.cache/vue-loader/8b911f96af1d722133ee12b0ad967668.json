{"remainingRequest":"/home/pedro/MEGA/Mestrado UAB/Programacao WEB Avancada/Tarefa 5/ProjetoFinal/Front-End/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/pedro/MEGA/Mestrado UAB/Programacao WEB Avancada/Tarefa 5/ProjetoFinal/Front-End/src/views/PropostaForm.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/pedro/MEGA/Mestrado UAB/Programacao WEB Avancada/Tarefa 5/ProjetoFinal/Front-End/src/views/PropostaForm.vue","mtime":1769966200427},{"path":"/home/pedro/MEGA/Mestrado UAB/Programacao WEB Avancada/Tarefa 5/ProjetoFinal/Front-End/node_modules/cache-loader/dist/cjs.js","mtime":1769949775297},{"path":"/home/pedro/MEGA/Mestrado UAB/Programacao WEB Avancada/Tarefa 5/ProjetoFinal/Front-End/node_modules/babel-loader/lib/index.js","mtime":1769949776082},{"path":"/home/pedro/MEGA/Mestrado UAB/Programacao WEB Avancada/Tarefa 5/ProjetoFinal/Front-End/node_modules/cache-loader/dist/cjs.js","mtime":1769949775297},{"path":"/home/pedro/MEGA/Mestrado UAB/Programacao WEB Avancada/Tarefa 5/ProjetoFinal/Front-End/node_modules/vue-loader/lib/index.js","mtime":1769949776231}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBodHRwIGZyb20gJy4uL2FwaS9odHRwJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIGRvY2VudGVzOiBbXSwKICAgICAgYWx1bm9zOiBbXSwKICAgICAgbm92YVBhbGF2cmE6ICcnLAogICAgICBlc3RhZG9PcHRpb25zOiBbCiAgICAgICAgeyB2YWx1ZTogJ3Jhc2N1bmhvJywgdGV4dDogJ1Jhc2N1bmhvJyB9LAogICAgICAgIHsgdmFsdWU6ICdwdWJsaWNhZGEnLCB0ZXh0OiAnUHVibGljYWRhJyB9LAogICAgICAgIHsgdmFsdWU6ICdhcnF1aXZhZGEnLCB0ZXh0OiAnQXJxdWl2YWRhJyB9CiAgICAgIF0sCiAgICAgIGZvcm06IHsKICAgICAgICB0aXR1bG86ICcnLAogICAgICAgIGVzdGFkbzogJ3Jhc2N1bmhvJywKICAgICAgICBjb29yaWVudGFkb3JlczogW10sCiAgICAgICAgYWx1bm9zOiBbXSwKICAgICAgICBwYWxhdnJhc0NoYXZlOiBbXSwKICAgICAgICBkZXNjcmljYW9PYmpldGl2b3M6ICcnCiAgICAgIH0KICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgaXNFZGl0KCkgewogICAgICByZXR1cm4gISF0aGlzLiRyb3V0ZS5wYXJhbXMuaWQ7CiAgICB9LAogICAgZG9jZW50ZU9wdGlvbnMoKSB7CiAgICAgIGNvbnN0IG1lID0gdGhpcy4kc3RvcmUuZ2V0dGVyc1snYXV0aC9kb2NlbnRlJ107CiAgICAgIHJldHVybiB0aGlzLmRvY2VudGVzCiAgICAgICAgLmZpbHRlcigoZCkgPT4gIW1lIHx8IGQuX2lkICE9PSBtZS5pZCkKICAgICAgICAubWFwKChkKSA9PiAoeyB2YWx1ZTogZC5faWQsIHRleHQ6IGAke2Qubm9tZX0gKCR7ZC5lbWFpbH0pYCB9KSk7CiAgICB9LAogICAgYWx1bm9PcHRpb25zKCkgewogICAgICByZXR1cm4gdGhpcy5hbHVub3MubWFwKChhKSA9PiAoeyB2YWx1ZTogYS5faWQsIHRleHQ6IGAke2Eubm9tZX0gKCMke2EubnVtZXJvfSlgIH0pKTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGFkZFBhbGF2cmEoKSB7CiAgICAgIGNvbnN0IHAgPSB0aGlzLm5vdmFQYWxhdnJhLnRyaW0oKTsKICAgICAgaWYgKCFwKSByZXR1cm47CiAgICAgIGlmICghdGhpcy5mb3JtLnBhbGF2cmFzQ2hhdmUuaW5jbHVkZXMocCkpIHRoaXMuZm9ybS5wYWxhdnJhc0NoYXZlLnB1c2gocCk7CiAgICAgIHRoaXMubm92YVBhbGF2cmEgPSAnJzsKICAgIH0sCiAgICByZW1vdmVQYWxhdnJhKGkpIHsKICAgICAgdGhpcy5mb3JtLnBhbGF2cmFzQ2hhdmUuc3BsaWNlKGksIDEpOwogICAgfSwKICAgIGFzeW5jIGNhcnJlZ2FyTGlzdGFzKCkgewogICAgICBjb25zdCBbZG9jLCBhbHVdID0gYXdhaXQgUHJvbWlzZS5hbGwoW2h0dHAuZ2V0KCcvZG9jZW50ZXMnKSwgaHR0cC5nZXQoJy9hbHVub3MnKV0pOwogICAgICB0aGlzLmRvY2VudGVzID0gZG9jLmRhdGE7CiAgICAgIHRoaXMuYWx1bm9zID0gYWx1LmRhdGE7CiAgICB9LAogICAgYXN5bmMgY2FycmVnYXJQcm9wb3N0YSgpIHsKICAgICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBodHRwLmdldChgL3Byb3Bvc3Rhcy8ke3RoaXMuJHJvdXRlLnBhcmFtcy5pZH1gKTsKICAgICAgdGhpcy5mb3JtID0gewogICAgICAgIHRpdHVsbzogZGF0YS50aXR1bG8sCiAgICAgICAgZXN0YWRvOiBkYXRhLmVzdGFkbywKICAgICAgICBjb29yaWVudGFkb3JlczogKGRhdGEuY29vcmllbnRhZG9yZXMgfHwgW10pLm1hcCgoZCkgPT4gZC5faWQpLAogICAgICAgIGFsdW5vczogKGRhdGEuYWx1bm9zIHx8IFtdKS5tYXAoKGEpID0+IGEuX2lkKSwKICAgICAgICBwYWxhdnJhc0NoYXZlOiBkYXRhLnBhbGF2cmFzQ2hhdmUgfHwgW10sCiAgICAgICAgZGVzY3JpY2FvT2JqZXRpdm9zOiBkYXRhLmRlc2NyaWNhb09iamV0aXZvcwogICAgICB9OwogICAgfSwKICAgIGFzeW5jIHN1Ym1pdCgpIHsKICAgICAgaWYgKCF0aGlzLmZvcm0ucGFsYXZyYXNDaGF2ZS5sZW5ndGgpIHsKICAgICAgICB0aGlzLiRhbGVydCgnSW5kaXF1ZSBwZWxvIG1lbm9zIHVtYSBwYWxhdnJhLWNoYXZlLicpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICB0cnkgewogICAgICAgIGlmICh0aGlzLmlzRWRpdCkgewogICAgICAgICAgYXdhaXQgaHR0cC5wdXQoYC9wcm9wb3N0YXMvJHt0aGlzLiRyb3V0ZS5wYXJhbXMuaWR9YCwgdGhpcy5mb3JtKTsKICAgICAgICAgIHRoaXMuJGFsZXJ0KCdQcm9wb3N0YSBhdHVhbGl6YWRhLicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhd2FpdCBodHRwLnBvc3QoJy9wcm9wb3N0YXMnLCB0aGlzLmZvcm0pOwogICAgICAgICAgdGhpcy4kYWxlcnQoJ1Byb3Bvc3RhIGNyaWFkYS4nKTsKICAgICAgICB9CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9taW5oYXMtcHJvcG9zdGFzJyk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zdCBtc2cgPSBlLnJlc3BvbnNlICYmIGUucmVzcG9uc2UuZGF0YSAmJiBlLnJlc3BvbnNlLmRhdGEubWVzc2FnZSA/IGUucmVzcG9uc2UuZGF0YS5tZXNzYWdlIDogJ0Vycm8gYSBndWFyZGFyLic7CiAgICAgICAgdGhpcy4kYWxlcnQobXNnKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIGFwYWdhcigpIHsKICAgICAgY29uc3Qgb2sgPSBhd2FpdCB0aGlzLiRjb25maXJtKCdUZW0gYSBjZXJ0ZXphIHF1ZSBxdWVyIGFwYWdhciBlc3RhIHByb3Bvc3RhPycpOwogICAgICBpZiAoIW9rKSByZXR1cm47CiAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7CiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgaHR0cC5kZWxldGUoYC9wcm9wb3N0YXMvJHt0aGlzLiRyb3V0ZS5wYXJhbXMuaWR9YCk7CiAgICAgICAgdGhpcy4kYWxlcnQoJ1Byb3Bvc3RhIGFwYWdhZGEuJyk7CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9taW5oYXMtcHJvcG9zdGFzJyk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICB0aGlzLiRhbGVydCgnRXJybyBhbyBhcGFnYXIuJyk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICB9LAogIGFzeW5jIGNyZWF0ZWQoKSB7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLmNhcnJlZ2FyTGlzdGFzKCk7CiAgICAgIGlmICh0aGlzLmlzRWRpdCkgYXdhaXQgdGhpcy5jYXJyZWdhclByb3Bvc3RhKCk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHRoaXMuJGFsZXJ0KCdFcnJvIGEgY2FycmVnYXIgZGFkb3MgZG8gZm9ybXVsw6FyaW8uJyk7CiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["PropostaForm.vue"],"names":[],"mappings":";AAwDA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PropostaForm.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div>\n    <b-button variant=\"link\" @click=\"$router.back()\">&larr; Voltar</b-button>\n    <h2>{{ isEdit ? 'Editar Proposta' : 'Nova Proposta' }}</h2>\n\n    <b-card>\n      <b-form @submit.prevent=\"submit\">\n        <b-form-group label=\"Título\">\n          <b-form-input v-model=\"form.titulo\" required />\n        </b-form-group>\n\n        <b-form-group label=\"Estado\">\n          <b-form-select v-model=\"form.estado\" :options=\"estadoOptions\" />\n        </b-form-group>\n\n        <b-form-group label=\"Coorientadores (opcional)\">\n          <b-form-select v-model=\"form.coorientadores\" :options=\"docenteOptions\" multiple />\n          <small class=\"text-muted\">O orientador é automaticamente o docente autenticado.</small>\n        </b-form-group>\n\n        <b-form-group label=\"Alunos (opcional)\">\n          <b-form-select v-model=\"form.alunos\" :options=\"alunoOptions\" multiple />\n        </b-form-group>\n\n        <b-form-group label=\"Palavras-chave\">\n          <div class=\"d-flex\">\n            <b-form-input v-model=\"novaPalavra\" placeholder=\"ex.: full-stack\" @keydown.enter.prevent=\"addPalavra\" />\n            <b-button class=\"ml-2\" variant=\"outline-primary\" @click=\"addPalavra\">Adicionar</b-button>\n          </div>\n          <div class=\"mt-2\">\n            <span v-for=\"(p, i) in form.palavrasChave\" :key=\"i\" class=\"badge badge-info mr-2\">\n              {{ p }}\n              <b-button size=\"sm\" variant=\"link\" class=\"p-0 ml-1\" @click=\"removePalavra(i)\">x</b-button>\n            </span>\n          </div>\n          <small class=\"text-muted\">Obrigatório (pelo menos 1).</small>\n        </b-form-group>\n\n        <b-form-group label=\"Descrição e objetivos\">\n          <b-form-textarea v-model=\"form.descricaoObjetivos\" rows=\"6\" required />\n        </b-form-group>\n\n        <div class=\"d-flex\">\n          <b-button type=\"submit\" variant=\"success\" :disabled=\"loading\">\n            {{ isEdit ? 'Guardar alterações' : 'Criar proposta' }}\n          </b-button>\n          <b-button v-if=\"isEdit\" class=\"ml-2\" variant=\"outline-danger\" @click=\"apagar\" :disabled=\"loading\">\n            Apagar\n          </b-button>\n        </div>\n      </b-form>\n    </b-card>\n  </div>\n</template>\n\n<script>\nimport http from '../api/http';\n\nexport default {\n  data() {\n    return {\n      loading: false,\n      docentes: [],\n      alunos: [],\n      novaPalavra: '',\n      estadoOptions: [\n        { value: 'rascunho', text: 'Rascunho' },\n        { value: 'publicada', text: 'Publicada' },\n        { value: 'arquivada', text: 'Arquivada' }\n      ],\n      form: {\n        titulo: '',\n        estado: 'rascunho',\n        coorientadores: [],\n        alunos: [],\n        palavrasChave: [],\n        descricaoObjetivos: ''\n      }\n    };\n  },\n  computed: {\n    isEdit() {\n      return !!this.$route.params.id;\n    },\n    docenteOptions() {\n      const me = this.$store.getters['auth/docente'];\n      return this.docentes\n        .filter((d) => !me || d._id !== me.id)\n        .map((d) => ({ value: d._id, text: `${d.nome} (${d.email})` }));\n    },\n    alunoOptions() {\n      return this.alunos.map((a) => ({ value: a._id, text: `${a.nome} (#${a.numero})` }));\n    }\n  },\n  methods: {\n    addPalavra() {\n      const p = this.novaPalavra.trim();\n      if (!p) return;\n      if (!this.form.palavrasChave.includes(p)) this.form.palavrasChave.push(p);\n      this.novaPalavra = '';\n    },\n    removePalavra(i) {\n      this.form.palavrasChave.splice(i, 1);\n    },\n    async carregarListas() {\n      const [doc, alu] = await Promise.all([http.get('/docentes'), http.get('/alunos')]);\n      this.docentes = doc.data;\n      this.alunos = alu.data;\n    },\n    async carregarProposta() {\n      const { data } = await http.get(`/propostas/${this.$route.params.id}`);\n      this.form = {\n        titulo: data.titulo,\n        estado: data.estado,\n        coorientadores: (data.coorientadores || []).map((d) => d._id),\n        alunos: (data.alunos || []).map((a) => a._id),\n        palavrasChave: data.palavrasChave || [],\n        descricaoObjetivos: data.descricaoObjetivos\n      };\n    },\n    async submit() {\n      if (!this.form.palavrasChave.length) {\n        this.$alert('Indique pelo menos uma palavra-chave.');\n        return;\n      }\n      this.loading = true;\n      try {\n        if (this.isEdit) {\n          await http.put(`/propostas/${this.$route.params.id}`, this.form);\n          this.$alert('Proposta atualizada.');\n        } else {\n          await http.post('/propostas', this.form);\n          this.$alert('Proposta criada.');\n        }\n        this.$router.push('/minhas-propostas');\n      } catch (e) {\n        const msg = e.response && e.response.data && e.response.data.message ? e.response.data.message : 'Erro a guardar.';\n        this.$alert(msg);\n      } finally {\n        this.loading = false;\n      }\n    },\n    async apagar() {\n      const ok = await this.$confirm('Tem a certeza que quer apagar esta proposta?');\n      if (!ok) return;\n      this.loading = true;\n      try {\n        await http.delete(`/propostas/${this.$route.params.id}`);\n        this.$alert('Proposta apagada.');\n        this.$router.push('/minhas-propostas');\n      } catch (e) {\n        this.$alert('Erro ao apagar.');\n      } finally {\n        this.loading = false;\n      }\n    }\n  },\n  async created() {\n    try {\n      await this.carregarListas();\n      if (this.isEdit) await this.carregarProposta();\n    } catch (e) {\n      this.$alert('Erro a carregar dados do formulário.');\n    }\n  }\n};\n</script>\n"]}]}